{% extends 'gestion/base.html' %}

{% block title %}Historial de Cambios{% endblock %}

{% block content %}
    <h1>Historial de Cambios de la Atención</h1>
    <p><strong>Paciente:</strong> {{ atencion.ficha_clinica.paciente.nombre }}</p>
    <p><strong>Fecha de Atención:</strong> {{ atencion.fecha_atencion.date }}</p>
    <a href="{% url 'detalle_paciente' atencion.ficha_clinica.paciente.id %}">&larr; Volver a la Ficha del Paciente</a>
    <hr>

    <table class="table table-striped table-bordered mt-4">
        <thead class="table-dark">
            <tr>
                <th>Fecha y Hora del Cambio</th>
                <th>Tipo de Cambio</th>
                <th>Usuario que realizó el cambio</th>
            </tr>
        </thead>
        <tbody>
            {% for registro in historial %}
                <tr>
                    <td>{{ registro.history_date }}</td>
                    <td>
                        {% if registro.history_type == '+' %}
                            <span class="badge bg-success">Creado</span>
                        {% elif registro.history_type == '~' %}
                            <span class="badge bg-warning text-dark">Modificado</span>
                        {% elif registro.history_type == '-' %}
                            <span class="badge bg-danger">Borrado</span>
                        {% endif %}
                    </td>
                    <td>{{ registro.history_user|default:"Sistema" }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="3">No hay historial de cambios para este registro.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}